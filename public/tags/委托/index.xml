<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>委托 on 古月月仔的博客</title>
    <link>http://localhost:1313/tags/%E5%A7%94%E6%89%98/</link>
    <description>Recent content in 委托 on 古月月仔的博客</description>
    <generator>Hugo</generator>
    <language>zh-cn</language>
    <lastBuildDate>Mon, 15 Apr 2024 00:00:00 +0800</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/%E5%A7%94%E6%89%98/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>【虚幻引擎】委托(Delegates)与回调(Callbacks)</title>
      <link>http://localhost:1313/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E5%A7%94%E6%89%98delegates%E4%B8%8E%E5%9B%9E%E8%B0%83callbacks/</link>
      <pubDate>Mon, 15 Apr 2024 00:00:00 +0800</pubDate>
      <guid>http://localhost:1313/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E5%A7%94%E6%89%98delegates%E4%B8%8E%E5%9B%9E%E8%B0%83callbacks/</guid>
      <description>&lt;p&gt;虚幻引擎的委托机制是一种类型安全的事件通知系统，支持动态绑定和多播功能，适用于观察者模式和回调实现。主要包括单播、多播、动态委托及事件等类型，并提供基本使用示例。&lt;/p&gt;&#xA;&lt;h1 id=&#34;unreal-engine-中的-delegates委托详解&#34;&gt;Unreal Engine 中的 Delegates（委托）详解&lt;/h1&gt;&#xA;&lt;p&gt;Delegates（委托）是 Unreal Engine 中一种强大的事件通知机制，它允许开发者在不直接引用类的情况下调用成员函数。本质上，委托是一种类型安全的函数指针，特别适合用于实现观察者模式、事件系统和回调机制。&lt;/p&gt;&#xA;&lt;h2 id=&#34;基本概念&#34;&gt;基本概念&lt;/h2&gt;&#xA;&lt;h3 id=&#34;核心特点&#34;&gt;核心特点&lt;/h3&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;类型安全&lt;/strong&gt;：编译时会检查函数签名匹配&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;动态绑定&lt;/strong&gt;：可以在运行时绑定/解绑函数&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;多播能力&lt;/strong&gt;：可以同时通知多个接收者（Multicast Delegates）&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;序列化支持&lt;/strong&gt;：部分委托类型支持蓝图序列化&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;委托类型&#34;&gt;委托类型&lt;/h2&gt;&#xA;&lt;p&gt;Unreal Engine 提供了几种主要的委托类型：&lt;/p&gt;&#xA;&lt;h3 id=&#34;1-单播委托-singlecast-delegates&#34;&gt;1. 单播委托 (Singlecast Delegates)&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DECLARE_DELEGATE(MyDelegate); &lt;span style=&#34;color:#75715e&#34;&gt;// 无参数&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DECLARE_DELEGATE_OneParam(MyParamDelegate, FString); &lt;span style=&#34;color:#75715e&#34;&gt;// 单参数&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DECLARE_DELEGATE_TwoParams(MyTwoParamDelegate, int32, &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;); &lt;span style=&#34;color:#75715e&#34;&gt;// 双参数&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;2-多播委托-multicast-delegates&#34;&gt;2. 多播委托 (Multicast Delegates)&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DECLARE_MULTICAST_DELEGATE(MyMulticastDelegate);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DECLARE_MULTICAST_DELEGATE_OneParam(MyMulticastParamDelegate, &lt;span style=&#34;color:#66d9ef&#34;&gt;float&lt;/span&gt;);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;3-动态委托-dynamic-delegates&#34;&gt;3. 动态委托 (Dynamic Delegates)&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DECLARE_DYNAMIC_DELEGATE(FMyDynamicDelegate);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DECLARE_DYNAMIC_MULTICAST_DELEGATE(FMyDynamicMulticastDelegate);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;4-事件-events&#34;&gt;4. 事件 (Events)&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DECLARE_EVENT(MyOwnerClass, MyEvent);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;使用示例&#34;&gt;使用示例&lt;/h2&gt;&#xA;&lt;h3 id=&#34;单播委托示例&#34;&gt;单播委托示例&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 声明一个带有一个参数(int32)的单播委托类型，命名为FScoreChangedDelegate&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 该委托用于在分数变化时通知订阅者&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;DECLARE_DELEGATE_OneParam(FScoreChangedDelegate, int32);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 定义一个继承自AActor的类AMyActor&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AMyActor&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; AActor&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 声明一个FScoreChangedDelegate类型的委托实例OnScoreChanged&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 这个委托将用于在分数更新时通知所有绑定的函数&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    FScoreChangedDelegate OnScoreChanged;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 更新分数的方法&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;UpdateScore&lt;/span&gt;(int32 NewScore)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 执行委托，通知所有绑定的函数&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// ExecuteIfBound是安全执行方法，只有在有绑定时才会实际调用&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 参数NewScore将传递给所有绑定的函数&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        OnScoreChanged.ExecuteIfBound(NewScore);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// 定义一个监听分数变化的类AMyListener&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AMyListener&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 绑定到分数变化委托的方法&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; BindToScoreChange(AMyActor&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; Actor)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 使用BindUObject将当前对象(this)的HandleScoreChanged方法绑定到Actor的OnScoreChanged委托&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// BindUObject专门用于绑定UObject成员函数，会自动处理对象生命周期&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        Actor&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;OnScoreChanged.BindUObject(&lt;span style=&#34;color:#66d9ef&#34;&gt;this&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;AMyListener&lt;span style=&#34;color:#f92672&#34;&gt;::&lt;/span&gt;HandleScoreChanged);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 处理分数变化的回调函数&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;void&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;HandleScoreChanged&lt;/span&gt;(int32 NewScore)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// 当分数变化时，记录日志显示新分数&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;// %d将被NewScore的值替换&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        UE_LOG(LogTemp, Warning, TEXT(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Score changed to %d&amp;#34;&lt;/span&gt;), NewScore);&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;执行流程&#34;&gt;执行流程&lt;/h4&gt;&#xA;&lt;pre class=&#34;mermaid&#34;&gt;&#xA;  sequenceDiagram&#xD;&#xA;    participant 调用方 as 调用方(AMyActor)&#xD;&#xA;    participant 委托系统 as 委托系统(OnScoreChanged)&#xD;&#xA;    participant 监听方 as 监听方(AMyListener)&#xD;&#xA;&#xD;&#xA;    Note over 监听方: 初始化阶段&#xD;&#xA;    监听方-&amp;gt;&amp;gt;委托系统: BindUObject(this, &amp;amp;AMyListener::HandleScoreChanged)&#xD;&#xA;    Note right of 委托系统: 存储绑定信息：&amp;lt;br/&amp;gt;- 目标对象(this)&amp;lt;br/&amp;gt;- 函数指针(HandleScoreChanged)&#xD;&#xA;&#xD;&#xA;    Note over 调用方: 执行阶段&#xD;&#xA;    调用方-&amp;gt;&amp;gt;委托系统: ExecuteIfBound(NewScore)&#xD;&#xA;    委托系统-&amp;gt;&amp;gt;监听方: 检查目标对象有效性&#xD;&#xA;    alt 对象有效&#xD;&#xA;        监听方--&amp;gt;&amp;gt;委托系统: 确认可调用&#xD;&#xA;        委托系统-&amp;gt;&amp;gt;监听方: 调用HandleScoreChanged(NewScore)&#xD;&#xA;        监听方-&amp;gt;&amp;gt;监听方: 执行日志输出 UE_LOG(...)&#xD;&#xA;    else 对象无效&#xD;&#xA;        委托系统--x 监听方: 跳过执行（自动清理绑定）&#xD;&#xA;    end&#xA;&lt;/pre&gt;&#xA;&#xA;&lt;p&gt;流程图有时候网页上无法基于代码绘制显示，再附一张截图&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
