<!DOCTYPE html>
<html lang="zh-cn">
    <head>
	<meta name="generator" content="Hugo 0.153.1"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>古月月仔的博客</title><meta name="Description" content="This is my cool site"><meta property="og:url" content="http://localhost:1313/">
  <meta property="og:site_name" content="古月月仔的博客">
  <meta property="og:title" content="古月月仔的博客">
  <meta property="og:description" content="This is my cool site">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="website">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="古月月仔的博客">
  <meta name="twitter:description" content="This is my cool site">
<meta name="application-name" content="My cool site">
<meta name="apple-mobile-web-app-title" content="My cool site"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:1313/" /><link rel="alternate" href="/index.xml" type="application/rss+xml" title="古月月仔的博客">
    <link rel="feed" href="/index.xml" type="application/rss+xml" title="古月月仔的博客"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "WebSite",
        "url": "http:\/\/localhost:1313\/","inLanguage": "zh-cn","author": {
                "@type": "Person",
                "name": "xxxx"
            },"description": "This is my cool site","name": "古月月仔的博客"
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="古月月仔的博客">My cool site</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"><i class='fas fa-archive'></i> 文章 </a><a class="menu-item" href="/categories/"><i class='fas fa-th'></i> 分类 </a><a class="menu-item" href="/tags/"><i class='fas fa-tags'></i> 标签 </a><a class="menu-item" href="/about/"><i class='fas fa-user-circle'></i> 关于 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="古月月仔的博客">My cool site</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title=""><i class='fas fa-archive'></i>文章</a><a class="menu-item" href="/categories/" title=""><i class='fas fa-th'></i>分类</a><a class="menu-item" href="/tags/" title=""><i class='fas fa-tags'></i>标签</a><a class="menu-item" href="/about/" title=""><i class='fas fa-user-circle'></i>关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
            delimiters: [
                {left: "$$", right: "$$", display: true},
                {left: "$", right: "$", display: false},
                {left: "\\(", right: "\\)", display: false},
                {left: "\\[", right: "\\]", display: true}
            ]
        });
    });
</script><main class="main">
                <div class="container"><div class="page home" data-home="posts"><div class="home-profile"><div class="home-avatar"><a href="/posts/" title="文章"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/ChipDog.jpg"
        data-srcset="/img/ChipDog.jpg, /img/ChipDog.jpg 1.5x, /img/ChipDog.jpg 2x"
        data-sizes="auto"
        alt="/img/ChipDog.jpg"
        title="/img/ChipDog.jpg" /></a></div><h1 class="home-title">古月月仔</h1><div class="home-subtitle"><div id="id-1" class="typeit"></div></div><div class="links"><a href="https://github.com/TingDongHu" title="GitHub" target="_blank" rel="noopener noreffer me"><i class="fab fa-github fa-fw" aria-hidden="true"></i></a><a href="https://www.zhihu.com/people/lin-chu-xin-44-90" title="知乎" target="_blank" rel="noopener noreffer me"><i data-svg-src="/lib/simple-icons/icons/zhihu.min.svg" aria-hidden="true"></i></a><a href="https://space.bilibili.com/473408368" title="bilibili" target="_blank" rel="noopener noreffer me"><i data-svg-src="/lib/simple-icons/icons/bilibili.min.svg" aria-hidden="true"></i></a><a href="mailto:2680957536@qq.com" title="Email" rel="me"><i class="far fa-envelope fa-fw" aria-hidden="true"></i></a></div></div>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
            <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8Egamemode%E5%92%8Cgamesate/"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/unrealengine.png"
        data-srcset="/img/unrealengine.png, /img/unrealengine.png 1.5x, /img/unrealengine.png 2x"
        data-sizes="auto"
        alt="/img/unrealengine.png"
        title="/img/unrealengine.png" /></a>
        </div><h1 class="single-title" itemprop="name headline">
        <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8Egamemode%E5%92%8Cgamesate/">【虚幻引擎】GameMode和GameSate</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>xxxx</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2024-04-21">2024-04-21</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>游戏开发</a>&nbsp;<a href="/categories/%E8%99%9A%E5%B9%BB%E5%8A%9F%E8%83%BD%E8%AE%B0%E5%BD%95/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>虚幻功能记录</a></span></div><div class="content"><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8Egamemode%E5%92%8Cgamesate/image-20250422211945454.png"
        data-srcset="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8Egamemode%E5%92%8Cgamesate/image-20250422211945454.png, /posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8Egamemode%E5%92%8Cgamesate/image-20250422211945454.png 1.5x, /posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8Egamemode%E5%92%8Cgamesate/image-20250422211945454.png 2x"
        data-sizes="auto"
        alt="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8Egamemode%E5%92%8Cgamesate/image-20250422211945454.png"
        title="image-20250422211945454" width="1274" height="691" /></p>
<p>在虚幻引擎（Unreal Engine）中，<strong>GameMode</strong> 和 <strong>GameState</strong> 都是多人游戏中的核心类，但它们的分工和用途有显著区别。以下是它们的对比和典型应用场景：</p>
<hr>
<h3 id="1-gamemode游戏规则管理者"><strong>1. GameMode（游戏规则管理者）</strong></h3>
<h4 id="职责"><strong>职责</strong></h4>
<ul>
<li><strong>仅存在于服务器端</strong>（不会复制到客户端）。</li>
<li><strong>定义游戏的核心规则</strong>：胜利条件、玩家生成逻辑、回合制规则等。</li>
<li><strong>管理玩家登录/退出</strong>（通过<code>Login</code>/<code>Logout</code>等事件）。</li>
<li><strong>生成并持有PlayerController、PlayerState等</strong>。</li>
</ul>
<h4 id="典型用途"><strong>典型用途</strong></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// 示例：在GameMode中设置玩家生成逻辑
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyGameMode<span style="color:#f92672">::</span>PostLogin(APlayerController<span style="color:#f92672">*</span> NewPlayer) {
</span></span><span style="display:flex;"><span>    Super<span style="color:#f92672">::</span>PostLogin(NewPlayer);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 生成玩家角色
</span></span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (NewPlayer<span style="color:#f92672">-&gt;</span>GetPawn() <span style="color:#f92672">==</span> <span style="color:#66d9ef">nullptr</span>) {
</span></span><span style="display:flex;"><span>        SpawnPlayerAtTransform(NewPlayer, SpawnTransform);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="关键特性"><strong>关键特性</strong></h4>
<ul>
<li><strong>服务器权威</strong>：客户端无法修改GameMode的逻辑。</li>
<li><strong>不复制</strong>：客户端无法直接访问GameMode。</li>
</ul>
<hr>
<h3 id="2-gamestate游戏状态同步者"><strong>2. GameState（游戏状态同步者）</strong></h3>
<h4 id="职责-1"><strong>职责</strong></h4>
<ul>
<li><strong>存在于服务器和客户端</strong>（自动复制到所有客户端）。</li>
<li><strong>存储并同步游戏全局状态</strong>：比分、剩余时间、玩家列表等。</li>
<li><strong>提供客户端可见的数据</strong>（如通过<code>PlayerArray</code>访问所有玩家的<code>PlayerState</code>）。</li>
</ul>
<h4 id="典型用途-1"><strong>典型用途</strong></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// 示例：在GameState中同步比分
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> AMyGameState<span style="color:#f92672">::</span>OnRep_TeamScores() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 客户端更新UI显示比分
</span></span></span><span style="display:flex;"><span>    UpdateScoreboardUI(TeamAScore, TeamBScore);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="关键特性-1"><strong>关键特性</strong></h4>
<ul>
<li><strong>数据同步</strong>：通过属性复制（<code>Replicated</code>）或RPC同步到客户端。</li>
<li><strong>客户端可读</strong>：UI可以直接绑定GameState的数据（如剩余时间）。</li>
</ul>
<hr>
<h3 id="核心区别对比"><strong>核心区别对比</strong></h3>
<table>
  <thead>
      <tr>
          <th><strong>特性</strong></th>
          <th><strong>GameMode</strong></th>
          <th><strong>GameState</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>存在位置</strong></td>
          <td>仅服务器</td>
          <td>服务器 + 客户端（复制）</td>
      </tr>
      <tr>
          <td><strong>用途</strong></td>
          <td>定义规则、逻辑控制</td>
          <td>存储和同步全局状态</td>
      </tr>
      <tr>
          <td><strong>是否复制到客户端</strong></td>
          <td>❌ 否</td>
          <td>✅ 是</td>
      </tr>
      <tr>
          <td><strong>客户端访问权限</strong></td>
          <td>无法直接访问</td>
          <td>可读取数据（如显示比分）</td>
      </tr>
      <tr>
          <td><strong>生命周期</strong></td>
          <td>游戏开始时创建，结束时销毁</td>
          <td>随游戏运行持续存在</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="协作流程示例"><strong>协作流程示例</strong></h3>
<ol>
<li><strong>服务器</strong>：
<ul>
<li>GameMode决定玩家生成规则（如出生点选择）。</li>
<li>GameState更新并同步比分到所有客户端。</li>
</ul>
</li>
<li><strong>客户端</strong>：
<ul>
<li>通过GameState获取实时比分，更新UI。</li>
<li>无法修改规则（必须通过服务器GameMode）。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="何时使用"><strong>何时使用？</strong></h3>
<ul>
<li><strong>用GameMode</strong>：
<ul>
<li>需要权威控制游戏逻辑（如判断胜利条件）。</li>
<li>处理玩家登录/退出等敏感操作。</li>
</ul>
</li>
<li><strong>用GameState</strong>：
<ul>
<li>需要让所有客户端知道全局状态（如倒计时、玩家列表）。</li>
<li>UI需要绑定的动态数据（如实时比分）。</li>
</ul>
</li>
</ul>
<p>通过这种分工，虚幻引擎实现了<strong>逻辑与状态的分离</strong>，确保多人游戏的同步性和安全性。</p></div><div class="post-footer">
        <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8Egamemode%E5%92%8Cgamesate/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/unrealengine/">UnrealEngine</a>,&nbsp;<a href="/tags/%E6%B8%B8%E6%88%8F%E6%A8%A1%E5%BC%8F/">游戏模式</a>,&nbsp;<a href="/tags/%E7%BB%A7%E6%89%BF/">继承</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
            <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/unrealengine.png"
        data-srcset="/img/unrealengine.png, /img/unrealengine.png 1.5x, /img/unrealengine.png 2x"
        data-sizes="auto"
        alt="/img/unrealengine.png"
        title="/img/unrealengine.png" /></a>
        </div><h1 class="single-title" itemprop="name headline">
        <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/">【虚幻引擎】虚幻5.1UUserWidget不再包含OnLevelRemovedFromWorld的问题</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>xxxx</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2024-04-20">2024-04-20</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>游戏开发</a>&nbsp;<a href="/categories/%E8%A7%A3%E5%86%B3bug%E8%AE%B0%E5%BD%95/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>解决bug记录</a></span></div><div class="content"><p>在跟着Blaster课程项目写Menu插件的时候,在Menu.h中一直报以下错误无法编译,百思不得其解.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/image-20250421115907081.png"
        data-srcset="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/image-20250421115907081.png, /posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/image-20250421115907081.png 1.5x, /posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/image-20250421115907081.png 2x"
        data-sizes="auto"
        alt="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/image-20250421115907081.png"
        title="image-20250421115907081" width="870" height="252" /></p>
<blockquote >
        <p>严重性代码说明项目文件33行禁止显示状态详细信息
错误C3668“UMenu::OnLevelRemovedFromWorld”: 包含重写说明符“override”的方法没有重写任何基类方法MenuSystem	F:\UE\UEproject\MultiplayCourse\MenuSystem\Plugins\MultiplayerSessions\Source\MultiplayerSessions\Public\Menu.h23</p>

    </blockquote><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/image-20250421120505541.png"
        data-srcset="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/image-20250421120505541.png, /posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/image-20250421120505541.png 1.5x, /posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/image-20250421120505541.png 2x"
        data-sizes="auto"
        alt="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/image-20250421120505541.png"
        title="image-20250421120505541" width="1071" height="332" /></p>
<p>查阅资料后发现是虚幻5.1和5.0的版本问题: 虚幻5.1 UUserWidget不再包含OnLevelRemovedFromWorld.我们可以重载一个类似的函数用于达到相同的效果:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span> <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">NativeDestruct</span>() <span style="color:#66d9ef">override</span>;
</span></span></code></pre></div><p><code>.cpp</code>文件中实现:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> UMenu<span style="color:#f92672">::</span>NativeDestruct()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    MenuTearDown();
</span></span><span style="display:flex;"><span>    Super<span style="color:#f92672">::</span>NativeDestruct();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>NativeDestruct()</code> 是 <code>UUserWidget</code>（用户控件）提供的一个 <strong>关键生命周期虚函数</strong>(析构函数)，用于 <strong>处理控件的销毁逻辑</strong>。</p>
<ul>
<li><strong>调用时机</strong>：
当 <code>UUserWidget</code> 被 ​<strong>显式移除（<code>RemoveFromParent</code>）​</strong>​ 或 ​<strong>其所属的 <code>UWorld</code> 销毁时</strong>​（如关卡切换、游戏退出），引擎会自动调用此函数。
<ul>
<li><strong>类比</strong>：类似于 Actor 的 <code>EndPlay()</code> 或 C++ 对象的析构函数。</li>
</ul>
</li>
<li><strong>核心用途</strong>：
<ul>
<li><strong>释放资源</strong>：清理绑定的动态委托（如按钮点击事件）、断开外部引用、销毁子控件等。</li>
<li><strong>防止内存泄漏</strong>：确保所有手动绑定的回调（如 <code>UWorld</code> 事件）被正确解绑。</li>
</ul>
</li>
</ul>
<p>替换后可正常编译与生成项目,问题解决.</p></div><div class="post-footer">
        <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E8%99%9A%E5%B9%BB5.1uuserwidget%E4%B8%8D%E5%86%8D%E5%8C%85%E5%90%ABonlevelremovedfromworld%E7%9A%84%E9%97%AE%E9%A2%98/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/c&#43;&#43;/">C&#43;&#43;</a>,&nbsp;<a href="/tags/unrealengine/">UnrealEngine</a>,&nbsp;<a href="/tags/%E7%BB%A7%E6%89%BF/">继承</a>,&nbsp;<a href="/tags/%E9%87%8D%E8%BD%BD/">重载</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
            <a href="/posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/unrealengine.png"
        data-srcset="/img/unrealengine.png, /img/unrealengine.png 1.5x, /img/unrealengine.png 2x"
        data-sizes="auto"
        alt="/img/unrealengine.png"
        title="/img/unrealengine.png" /></a>
        </div><h1 class="single-title" itemprop="name headline">
        <a href="/posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/">【MultiplayerCourse】创建多人联机插件</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>xxxx</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2024-04-19">2024-04-19</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>游戏开发</a>&nbsp;<a href="/categories/multiplayercourse/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>MultiplayerCourse</a></span></div><div class="content"><p>此博客为学习油管DruidMech大佬的广域网多人射击游戏的笔记
附上项目GitHub源码地址https://github.com/DruidMech/MultiplayerCourseMenuSystem</p>
<h2 id="新建项目">新建项目</h2>
<p>首先使用引擎（5.0及以上）创建一个基于第三人称模板的<code>.cpp</code>项目，我这里将其命名为<code>MenuSystem</code>.</p>
<h2 id="subsystem插件配置">Subsystem插件配置</h2>
<p>一、在编辑器-插件中打开<code>Oline Subsystem Steam</code>插件，然后重启项目。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/image-20250419144230516.png"
        data-srcset="/posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/image-20250419144230516.png, /posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/image-20250419144230516.png 1.5x, /posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/image-20250419144230516.png 2x"
        data-sizes="auto"
        alt="/posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/image-20250419144230516.png"
        title="image-20250419144230516" width="1220" height="724" /></p>
<p>二、在项目的<code>Build.cs</code>下找到一个<code>PublicDependencyModuleNames</code>,把插件的配置项<code>OnlineSubsystemSteam</code>、<code>OnlineSubsystem</code>添加到其中然后编译</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>PublicDependencyModuleNames.AddRange(<span style="color:#66d9ef">new</span> <span style="color:#66d9ef">string</span>[] { <span style="color:#e6db74">&#34;Core&#34;</span>, <span style="color:#e6db74">&#34;CoreUObject&#34;</span>, <span style="color:#e6db74">&#34;Engine&#34;</span>, <span style="color:#e6db74">&#34;InputCore&#34;</span>, <span style="color:#e6db74">&#34;HeadMountedDisplay&#34;</span>, <span style="color:#e6db74">&#34;EnhancedInput&#34;</span> ,<span style="color:#e6db74">&#34;OnlineSubsystemSteam&#34;</span>,<span style="color:#e6db74">&#34;OnlineSubsystem&#34;</span>});
</span></span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/image-20250419145217432.png"
        data-srcset="/posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/image-20250419145217432.png, /posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/image-20250419145217432.png 1.5x, /posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/image-20250419145217432.png 2x"
        data-sizes="auto"
        alt="/posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/image-20250419145217432.png"
        title="image-20250419145217432" width="434" height="231" /></p>
<p>三、在<code>项目/config/DefaultEngine.ini</code>中添加下面代码</p>
<pre tabindex="0"><code>[/Script/Engine.GameEngine]
	+NetDriverDefinitions=(DefName=&#34;GameNetDriver&#34;,DriverClassName=&#34;OnlineSubsystemSteam.SteamNetDriver&#34;,DriverClassNameFallback=&#34;OnlineSubsystemUtils.IpNetDriver&#34;)
 
	[OnlineSubsystem]
	DefaultPlatformService=Steam
 
	[OnlineSubsystemSteam]
	bEnabled=true
	SteamDevAppId=480
 
	; If using Sessions
	; bInitServerOnClient=true
 
	[/Script/OnlineSubsystemSteam.SteamNetDriver]
	NetConnectionClassName=&#34;OnlineSubsystemSteam.SteamNetConnection&#34;
</code></pre><p>注意：</p>
<ul>
<li>
<p>此处<code>SteamDevAppId=480</code>的ID是一个示范项目(星空)的ID</p>
</li>
<li>
<p>子系统的具体用法和配置参考如下文档<a href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/online-subsystem-in-unreal-engine?application_version=5.1" target="_blank" rel="noopener noreffer ">Online Subsystem in Unreal Engine | 虚幻引擎 5.1 文档 | Epic Developer Community</a></p>
</li>
</ul>
<p>四、删除缓存文件<code>saved</code>、<code>Intermediate</code>、<code>Binaries</code>后然右键<code>.object</code>文件重新构建生成项目（<code>GenerateProject</code>）,完成配置。</p>
<h2 id="访问在线子系统">访问在线子系统</h2>
<h3 id="在character类中添加引用">在<code>Character</code>类中添加引用</h3>
<p>一、修改头文件<code>Character.h</code>为其添加管理在线游戏会话的智能指针声明，在类底部写一个新的<code>public</code>关键字用于区分系统源码与我们书写的代码</p>
<p>添加如下代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    TSharedPtr<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IOnlineSession</span>, ESPMode<span style="color:#f92672">::</span>ThreadSafe<span style="color:#f92672">&gt;</span> OnlineSessionInterface;
</span></span></code></pre></div><p>修改解释：</p></div><div class="post-footer">
        <a href="/posts/multiplayercourse%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA%E6%8F%92%E4%BB%B6/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/unrealengine/">UnrealEngine</a>,&nbsp;<a href="/tags/%E6%8F%92%E4%BB%B6/">插件</a>,&nbsp;<a href="/tags/%E5%A4%9A%E4%BA%BA%E8%81%94%E6%9C%BA/">多人联机</a>,&nbsp;<a href="/tags/steam/">Steam</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
            <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E5%A7%94%E6%89%98delegates%E4%B8%8E%E5%9B%9E%E8%B0%83callbacks/"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/unrealengine.png"
        data-srcset="/img/unrealengine.png, /img/unrealengine.png 1.5x, /img/unrealengine.png 2x"
        data-sizes="auto"
        alt="/img/unrealengine.png"
        title="/img/unrealengine.png" /></a>
        </div><h1 class="single-title" itemprop="name headline">
        <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E5%A7%94%E6%89%98delegates%E4%B8%8E%E5%9B%9E%E8%B0%83callbacks/">【虚幻引擎】委托(Delegates)与回调(Callbacks)</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>xxxx</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2024-04-15">2024-04-15</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>游戏开发</a>&nbsp;<a href="/categories/%E8%99%9A%E5%B9%BB%E5%8A%9F%E8%83%BD%E8%AE%B0%E5%BD%95/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>虚幻功能记录</a></span></div><div class="content"><h1 id="unreal-engine-中的-delegates委托详解">Unreal Engine 中的 Delegates（委托）详解</h1>
<p>Delegates（委托）是 Unreal Engine 中一种强大的事件通知机制，它允许开发者在不直接引用类的情况下调用成员函数。本质上，委托是一种类型安全的函数指针，特别适合用于实现观察者模式、事件系统和回调机制。</p>
<h2 id="基本概念">基本概念</h2>
<h3 id="核心特点">核心特点</h3>
<ul>
<li><strong>类型安全</strong>：编译时会检查函数签名匹配</li>
<li><strong>动态绑定</strong>：可以在运行时绑定/解绑函数</li>
<li><strong>多播能力</strong>：可以同时通知多个接收者（Multicast Delegates）</li>
<li><strong>序列化支持</strong>：部分委托类型支持蓝图序列化</li>
</ul>
<h2 id="委托类型">委托类型</h2>
<p>Unreal Engine 提供了几种主要的委托类型：</p>
<h3 id="1-单播委托-singlecast-delegates">1. 单播委托 (Singlecast Delegates)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>DECLARE_DELEGATE(MyDelegate); <span style="color:#75715e">// 无参数
</span></span></span><span style="display:flex;"><span>DECLARE_DELEGATE_OneParam(MyParamDelegate, FString); <span style="color:#75715e">// 单参数
</span></span></span><span style="display:flex;"><span>DECLARE_DELEGATE_TwoParams(MyTwoParamDelegate, int32, <span style="color:#66d9ef">bool</span>); <span style="color:#75715e">// 双参数
</span></span></span></code></pre></div><h3 id="2-多播委托-multicast-delegates">2. 多播委托 (Multicast Delegates)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>DECLARE_MULTICAST_DELEGATE(MyMulticastDelegate);
</span></span><span style="display:flex;"><span>DECLARE_MULTICAST_DELEGATE_OneParam(MyMulticastParamDelegate, <span style="color:#66d9ef">float</span>);
</span></span></code></pre></div><h3 id="3-动态委托-dynamic-delegates">3. 动态委托 (Dynamic Delegates)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>DECLARE_DYNAMIC_DELEGATE(FMyDynamicDelegate);
</span></span><span style="display:flex;"><span>DECLARE_DYNAMIC_MULTICAST_DELEGATE(FMyDynamicMulticastDelegate);
</span></span></code></pre></div><h3 id="4-事件-events">4. 事件 (Events)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>DECLARE_EVENT(MyOwnerClass, MyEvent);
</span></span></code></pre></div><h2 id="使用示例">使用示例</h2>
<h3 id="单播委托示例">单播委托示例</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// 声明一个带有一个参数(int32)的单播委托类型，命名为FScoreChangedDelegate
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 该委托用于在分数变化时通知订阅者
</span></span></span><span style="display:flex;"><span>DECLARE_DELEGATE_OneParam(FScoreChangedDelegate, int32);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 定义一个继承自AActor的类AMyActor
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AMyActor</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> AActor
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 声明一个FScoreChangedDelegate类型的委托实例OnScoreChanged
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 这个委托将用于在分数更新时通知所有绑定的函数
</span></span></span><span style="display:flex;"><span>    FScoreChangedDelegate OnScoreChanged;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 更新分数的方法
</span></span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">UpdateScore</span>(int32 NewScore)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 执行委托，通知所有绑定的函数
</span></span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ExecuteIfBound是安全执行方法，只有在有绑定时才会实际调用
</span></span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 参数NewScore将传递给所有绑定的函数
</span></span></span><span style="display:flex;"><span>        OnScoreChanged.ExecuteIfBound(NewScore);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 定义一个监听分数变化的类AMyListener
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AMyListener</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 绑定到分数变化委托的方法
</span></span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> BindToScoreChange(AMyActor<span style="color:#f92672">*</span> Actor)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 使用BindUObject将当前对象(this)的HandleScoreChanged方法绑定到Actor的OnScoreChanged委托
</span></span></span><span style="display:flex;"><span>        <span style="color:#75715e">// BindUObject专门用于绑定UObject成员函数，会自动处理对象生命周期
</span></span></span><span style="display:flex;"><span>        Actor<span style="color:#f92672">-&gt;</span>OnScoreChanged.BindUObject(<span style="color:#66d9ef">this</span>, <span style="color:#f92672">&amp;</span>AMyListener<span style="color:#f92672">::</span>HandleScoreChanged);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 处理分数变化的回调函数
</span></span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">HandleScoreChanged</span>(int32 NewScore)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 当分数变化时，记录日志显示新分数
</span></span></span><span style="display:flex;"><span>        <span style="color:#75715e">// %d将被NewScore的值替换
</span></span></span><span style="display:flex;"><span>        UE_LOG(LogTemp, Warning, TEXT(<span style="color:#e6db74">&#34;Score changed to %d&#34;</span>), NewScore);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h4 id="执行流程">执行流程</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">sequenceDiagram
    participant 调用方 as 调用方(AMyActor)
    participant 委托系统 as 委托系统(OnScoreChanged)
    participant 监听方 as 监听方(AMyListener)

    Note over 监听方: 初始化阶段
    监听方-&gt;&gt;委托系统: BindUObject(this, &amp;AMyListener::HandleScoreChanged)
    Note right of 委托系统: 存储绑定信息：&lt;br/&gt;- 目标对象(this)&lt;br/&gt;- 函数指针(HandleScoreChanged)

    Note over 调用方: 执行阶段
    调用方-&gt;&gt;委托系统: ExecuteIfBound(NewScore)
    委托系统-&gt;&gt;监听方: 检查目标对象有效性
    alt 对象有效
        监听方--&gt;&gt;委托系统: 确认可调用
        委托系统-&gt;&gt;监听方: 调用HandleScoreChanged(NewScore)
        监听方-&gt;&gt;监听方: 执行日志输出 UE_LOG(...)
    else 对象无效
        委托系统--x 监听方: 跳过执行（自动清理绑定）
    end
</code></pre><p>流程图有时候网页上无法基于代码绘制显示，再附一张截图</p></div><div class="post-footer">
        <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E%E5%A7%94%E6%89%98delegates%E4%B8%8E%E5%9B%9E%E8%B0%83callbacks/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/unrealengine/">UnrealEngine</a>,&nbsp;<a href="/tags/%E5%A7%94%E6%89%98/">委托</a>,&nbsp;<a href="/tags/%E5%9B%9E%E8%B0%83/">回调</a>,&nbsp;<a href="/tags/%E4%BA%8B%E4%BB%B6%E9%80%9A%E4%BF%A1/">事件通信</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
            <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8Euc&#43;&#43;%E7%9A%84%E5%AE%8F%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95/"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/unrealengine.png"
        data-srcset="/img/unrealengine.png, /img/unrealengine.png 1.5x, /img/unrealengine.png 2x"
        data-sizes="auto"
        alt="/img/unrealengine.png"
        title="/img/unrealengine.png" /></a>
        </div><h1 class="single-title" itemprop="name headline">
        <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8Euc&#43;&#43;%E7%9A%84%E5%AE%8F%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95/">【虚幻引擎】UC++的宏定义语法</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>xxxx</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2024-04-10">2024-04-10</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>游戏开发</a></span></div><div class="content"><h2 id="unreal-engine中宏定义语法的使用">Unreal Engine中宏定义语法的使用</h2>
<h3 id="示例代码">示例代码：</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">// 类声明宏：使类被纳入Unreal反射系统
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - Blueprintable：允许在蓝图中创建该类的子类
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// - meta=(DisplayName=&#34;My Object&#34;)：在编辑器中显示的自定义名称
</span></span></span><span style="display:flex;"><span>UCLASS(Blueprintable, meta<span style="color:#f92672">=</span>(DisplayName<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;My Object&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UMyObject</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> UObject  <span style="color:#75715e">// 必须继承UObject或其子类
</span></span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 代码生成宏：必须出现在类体内第一个位置
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">// - 展开后会包含类型信息、反射数据等引擎所需的内容
</span></span></span><span style="display:flex;"><span>    GENERATED_BODY()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 属性声明宏：将成员变量暴露给反射系统
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">// - EditAnywhere：可在编辑器的任意位置（如蓝图、细节面板）编辑此属性
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">// - Category=&#34;Stats&#34;：在编辑器中归入&#34;Stats&#34;分类组
</span></span></span><span style="display:flex;"><span>    UPROPERTY(EditAnywhere, Category<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Stats&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> Health <span style="color:#f92672">=</span> <span style="color:#ae81ff">100.0f</span>;  <span style="color:#75715e">// 带默认值的公开属性
</span></span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 函数声明宏：将函数暴露给反射系统
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">// - BlueprintCallable：允许蓝图调用此方法
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">// - 可添加其他说明符如：
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">//   - Category=&#34;Gameplay&#34;：函数分组
</span></span></span><span style="display:flex;"><span>    <span style="color:#75715e">//   - meta=(ToolTip=&#34;Heal amount&#34;)：悬停提示文本
</span></span></span><span style="display:flex;"><span>    UFUNCTION(BlueprintCallable)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> Heal(<span style="color:#66d9ef">float</span> Amount);  <span style="color:#75715e">// 可被蓝图调用的方法
</span></span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h3 id="关键宏参数详解">关键宏参数详解：</h3>
<h4 id="uclass-常用参数">UCLASS 常用参数：</h4>
<table>
  <thead>
      <tr>
          <th>参数</th>
          <th>作用</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Blueprintable</td>
          <td>允许基于此类创建蓝图</td>
      </tr>
      <tr>
          <td>BlueprintType</td>
          <td>允许在蓝图中作为变量类型使用</td>
      </tr>
      <tr>
          <td>NotBlueprintable</td>
          <td>明确禁止蓝图继承（默认）</td>
      </tr>
      <tr>
          <td>meta=(DisplayName)</td>
          <td>编辑器显示名称</td>
      </tr>
  </tbody>
</table>
<h4 id="uproperty-常用参数">UPROPERTY 常用参数：</h4>
<table>
  <thead>
      <tr>
          <th>参数</th>
          <th>作用</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>VisibleAnywhere</td>
          <td>属性可见但不可编辑</td>
      </tr>
      <tr>
          <td>EditAnywhere</td>
          <td>属性可任意编辑</td>
      </tr>
      <tr>
          <td>EditDefaultsOnly</td>
          <td>仅允许在类默认值中编辑</td>
      </tr>
      <tr>
          <td>BlueprintReadOnly</td>
          <td>蓝图只读访问</td>
      </tr>
      <tr>
          <td>Category</td>
          <td>属性分类（编辑器分组）</td>
      </tr>
      <tr>
          <td>meta=(ClampMin=0)</td>
          <td>元数据：限制最小值</td>
      </tr>
  </tbody>
</table>
<h4 id="ufunction-常用参数">UFUNCTION 常用参数：</h4>
<table>
  <thead>
      <tr>
          <th>参数</th>
          <th>作用</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>BlueprintCallable</td>
          <td>可从蓝图调用</td>
      </tr>
      <tr>
          <td>BlueprintPure</td>
          <td>纯函数（无副作用）</td>
      </tr>
      <tr>
          <td>Category</td>
          <td>函数分类</td>
      </tr>
      <tr>
          <td>meta=(Deprecated)</td>
          <td>标记为已弃用</td>
      </tr>
  </tbody>
</table>
<h3 id="特殊说明">特殊说明：</h3>
<ol>
<li>
<p><code>GENERATED_BODY()</code> 必须：</p></div><div class="post-footer">
        <a href="/posts/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8Euc&#43;&#43;%E7%9A%84%E5%AE%8F%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/unrealengine/">UnrealEngine</a>,&nbsp;<a href="/tags/%E8%AF%AD%E6%B3%95/">语法</a>,&nbsp;<a href="/tags/c&#43;&#43;/">C&#43;&#43;</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
            <a href="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/GameDesign.png"
        data-srcset="/img/GameDesign.png, /img/GameDesign.png 1.5x, /img/GameDesign.png 2x"
        data-sizes="auto"
        alt="/img/GameDesign.png"
        title="/img/GameDesign.png" /></a>
        </div><h1 class="single-title" itemprop="name headline">
        <a href="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/">【游戏设计】游戏开发中AI</a>
    </h1><div class="post-meta"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>xxxx</a></span>&nbsp;<span class="post-publish">发布于 <time datetime="2024-04-06">2024-04-06</time></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>游戏开发</a>&nbsp;<a href="/categories/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>游戏设计思想</a></span></div><div class="content"><p>文章的思路来源于Voidmatrix大神视频总结，以及一些本人开发BossAI的感悟所写。</p>
<p>附上大神原视频链接：<a href="https://www.bilibili.com/video/BV13EdSYgEGR/?share_source=copy_web&amp;vd_source=a06df7b174b0e55e45242729b8ce1758" target="_blank" rel="noopener noreffer ">【游戏开发秘籍】状态机？行为树？一个视频速通游戏开发中的AI！#06</a></p>
<h2 id="游戏ai是什么">游戏AI是什么</h2>
<p>​	**游戏开发领域中，AI通常指的是对非玩家角色行为的设计与研究，让他们能够感知周围的环境，并且做出相应的动作表现。**例如和玩家交互聊天的NPC、按照特定规则巡逻的怪物或是直接与玩家进行对抗的人机等等，一个能与我们的游戏玩法相匹配，逻辑自洽的角色，除去策划上的工作，在开发技术上也是大有研究的。</p>
<p><strong>游戏AI的核心目标</strong></p>
<ul>
<li><strong>增强体验</strong>：通过智能的NPC行为、动态难度调整等提升游戏趣味性。</li>
<li><strong>创造挑战</strong>：让敌人或对手具备合理的策略，避免过于简单或作弊。</li>
<li><strong>模拟世界</strong>：构建逼真的生态系统（如《荒野之息》中的动物行为）。</li>
</ul>
<h2 id="状态机fsm">状态机（FSM）</h2>
<p>​			<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417110706673.png"
        data-srcset="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417110706673.png, /posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417110706673.png 1.5x, /posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417110706673.png 2x"
        data-sizes="auto"
        alt="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417110706673.png"
        title="image-20250417110706673" width="911" height="511" /></p>
<p>​	最经典最简单的AI实现技术便是<strong>状态机</strong>，我们可以把NPC的每一个具体的行动都拆分成一个独立的状态。</p>
<p>​	接下来我们只需要设计好状态间的挑战条件就可以了，譬如 NPC拥有巡逻、攻击、逃跑和治疗4个状态，默认的入口状态为巡逻，也就是在这个NPC在程序中被实例化添加到游戏世界中时，它便会巡视自己的领地。按照固定的路线徘徊，当玩家等敌对角色进入到他的视野范围后，状态机便会跳转到攻击的状态，在攻击状态下，他会持续逼近玩家的位置，并且试图对其造成伤害。而当在这个战斗过程中自身生命值低于一定数值时，NPC就会进入到逃跑状态，在逃离玩家一定范围后，他们也会停下来治疗自己，恢复生命值，然后继续进入到巡逻或是战斗的状态循环，整套逻辑，这样一个栩栩如生的NPC角色就诞生在了我们创造的游戏世界中了。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111013341.png"
        data-srcset="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111013341.png, /posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111013341.png 1.5x, /posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111013341.png 2x"
        data-sizes="auto"
        alt="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111013341.png"
        title="image-20250417111013341" width="1639" height="890" /></p>
<p>​	而作为最经典的压实线状态机的实验代码，可以说是最简单的了。</p>
<p>​	以前面空洞武士项目教程中的代码为例，对于状态节点的设计，我们除去执行更新到 update接口外，通常还需要预留on inter和on X的接口，用来通知该状态的进入并进行初始化以及处理状态退出式的逻辑，譬如在攻击状态进入和退出时，我们需要设置NPC手持武器道具的可见性，并且更新其锁敌感知范围的逻辑，对于状态机本身等待提供 update的更新方法外，也还需要提供设置入口状态，切换状态和注册新状态的接口，为了更快捷的查找，在实际开发过程中，我们可以使用媒体书读或是哈希表来存储状态ID到具体状态对象的映射，那么在状态机更新的过程中，实际执行了当前选中的状态攻击方法，在设置入口状态或是切换不同的状态时，也只需要根据传入的ID，将当前状态指针指向不同的具体状态对象即可。</p>
<h3 id="状态机的弊端">状态机的弊端</h3>
<p>​	不过跟过空洞武士项目介绍的同学其实可能就已经意识到了这台机正如AI实现方法的弊端了，**不同的状态之间彼此穿插，如果我们要新增一个状态或是修改已有的状态跳转条件时，都需要考虑与现有状态的调整关系，当系统的状态数过多时，维护各个状态间的关系就会变得非常困难。**那么封装的思想这时就起作用了，我们能否把功能相似的具体状态封装成一个更大的抽象状态，我们只需要去关注不同抽象状态间的跳转，思路便会清晰很多。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111541371.png"
        data-srcset="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111541371.png, /posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111541371.png 1.5x, /posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111541371.png 2x"
        data-sizes="auto"
        alt="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111541371.png"
        title="image-20250417111541371" width="1644" height="876" /></p>
<h3 id="分层状态机">分层状态机</h3>
<p>以前面的NPC行动为例，我们现在需要在巡逻攻击淘宝和治疗4个游状态中加入新的工作状态角色在巡逻一段时间没有发现威胁后，会进入到工作状态，收集环境、中的、资源来制作武器和药品等道具。这工作状态显然又分为收集和制作2个子状态，如果我们依然按照先前的思路，那么这6个状态间的跳转关系就开始变得有些让人眼花缭乱了。</p>
<p>我们做以下改进：</p>
<ul>
<li>巡逻和攻击状态归类为战斗状态</li>
<li>逃跑和治疗归类为恢复状态</li>
<li>收集和制作归类为工作状态</li>
</ul>
<p>这样原本错综复杂的状态关系现在变非常清晰了，我们只需要维护好父级状态间的跳转条件，并且在父状态内部理清子状态的条件，一切就又可以水到渠成，井然有序了，而这便是<strong>分层状态机</strong>的实现。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111621117.png"
        data-srcset="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111621117.png, /posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111621117.png 1.5x, /posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111621117.png 2x"
        data-sizes="auto"
        alt="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/image-20250417111621117.png"
        title="image-20250417111621117" width="1610" height="867" /></p></div><div class="post-footer">
        <a href="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E4%B8%ADai/">阅读全文</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E6%B8%B8%E6%88%8Fai/">游戏AI</a>,&nbsp;<a href="/tags/%E8%A1%8C%E4%B8%BA%E6%A0%91/">行为树</a>,&nbsp;<a href="/tags/%E7%8A%B6%E6%80%81%E6%9C%BA/">状态机</a></div></div>
</article><ul class="pagination"><li class="page-item ">
                    <span class="page-link">
                        <a href="/">1</a>
                    </span>
                </li><li class="page-item ">
                    <span class="page-link" aria-hidden="true">&hellip;</span>
                </li><li class="page-item ">
                    <span class="page-link">
                        <a href="/page/5/">5</a>
                    </span>
                </li><li class="page-item ">
                    <span class="page-link">
                        <a href="/page/6/">6</a>
                    </span>
                </li><li class="page-item active">
                    <span class="page-link">
                        <a href="/page/7/">7</a>
                    </span>
                </li><li class="page-item ">
                    <span class="page-link">
                        <a href="/page/8/">8</a>
                    </span>
                </li><li class="page-item ">
                    <span class="page-link">
                        <a href="/page/9/">9</a>
                    </span>
                </li></ul></div></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.153.1">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">xxxx</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/index.umd.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"data":{"id-1":"计算机在校生||游戏程序员"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
