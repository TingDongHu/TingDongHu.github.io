--- 
title: 【虚幻引擎】虚幻5.1UUserWidget不再包含OnLevelRemovedFromWorld的问题
date: 2024-04-20
categories: ["虚幻引擎"]
tags: ["C++", "UnrealEngine", "继承", "重载"]
description: "虚幻引擎5.1移除了`OnLevelRemovedFromWorld`函数，导致编译错误。解决方案是重写`NativeDestruct`函数来实现资源清理逻辑，从而成功编译。"
cover: "/img/unrealengine.png"
headerImage: "/img/sakura.png"
math: true
--- 

在虚幻引擎5.1中，`OnLevelRemovedFromWorld`函数已被移除，导致编译错误。解决方案是重写`NativeDestruct`函数来实现相同的资源清理逻辑，从而成功编译。 



在跟着Blaster课程项目写Menu插件的时候,在Menu.h中一直报以下错误无法编译,百思不得其解.

![image-20250421115907081](虚幻引擎虚幻5.1uuserwidget不再包含onlevelremovedfromworld的问题/image-20250421115907081.png)

>严重性代码说明项目文件33行禁止显示状态详细信息
>错误C3668“UMenu::OnLevelRemovedFromWorld”: 包含重写说明符“override”的方法没有重写任何基类方法MenuSystem	F:\UE\UEproject\MultiplayCourse\MenuSystem\Plugins\MultiplayerSessions\Source\MultiplayerSessions\Public\Menu.h23		

![image-20250421120505541](虚幻引擎虚幻5.1uuserwidget不再包含onlevelremovedfromworld的问题/image-20250421120505541.png)

查阅资料后发现是虚幻5.1和5.0的版本问题: 虚幻5.1 UUserWidget不再包含OnLevelRemovedFromWorld.我们可以重载一个类似的函数用于达到相同的效果:

```cpp
 virtual void NativeDestruct() override;
```

`.cpp`文件中实现:

```cpp
void UMenu::NativeDestruct()
{
    MenuTearDown();
    Super::NativeDestruct();
}
```

`NativeDestruct()` 是 `UUserWidget`（用户控件）提供的一个 **关键生命周期虚函数**(析构函数)，用于 **处理控件的销毁逻辑**。

- **调用时机**：
  当 `UUserWidget` 被 ​**显式移除（`RemoveFromParent`）​**​ 或 ​**其所属的 `UWorld` 销毁时**​（如关卡切换、游戏退出），引擎会自动调用此函数。
  - **类比**：类似于 Actor 的 `EndPlay()` 或 C++ 对象的析构函数。
- **核心用途**：
  - **释放资源**：清理绑定的动态委托（如按钮点击事件）、断开外部引用、销毁子控件等。
  - **防止内存泄漏**：确保所有手动绑定的回调（如 `UWorld` 事件）被正确解绑。

替换后可正常编译与生成项目,问题解决.